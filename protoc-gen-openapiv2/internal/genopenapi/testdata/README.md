**testdata** directory comprises files purtinent to testing of **genopenapi** package.

| file | short description |
| ------ | ------ |
| buf.yaml | defines a [buf module](https://docs.buf.build/configuration/v1/buf-yaml)|
| buf.gen.yaml | defines a local [generation template](https://docs.buf.build/configuration/v1/buf-gen-yaml) | 
| *.cgreq | output files generated by **protoc-gen-cgreq** plugin |
| *.proto | are files OpenAPI (swagger) documentation is generated from |
| *.emitted.swagger.json | OpenAPI (swagger) json documents emitted/generated by tests |
| *.wanted.swagger.json | OpenAPI (swagger) json documents used in tests for comparison |
| imports/*.proto | dependent proto files imported by **_testdata/\*.proto_** files |

# Development Notes

**_testdata/\*.proto_** files do not partake in tests because, being a plugin to protocol buffer compiler ([protoc](https://developers.google.com/protocol-buffers/docs/gotutorial#compiling-your-protocol-buffers), [protogen](https://pkg.go.dev/google.golang.org/protobuf/compiler/protogen)), **protoc-gen-openapiv2**
processes objects of CodeGeneratorRequest that are forwarded by protoc itself.

https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/compiler/plugin.proto
> protoc (aka the Protocol Compiler) can be extended via plugins.  A plugin is just a program that reads a CodeGeneratorRequest from stdin and writes a CodeGeneratorResponse to stdout.

So, the proto files should be first converted to their CodeGeneratorRequest representation which is what **protoc-gen-cgreq** plugin is for. It takes an object of CodeGeneratorRequest as an input and stores it as a file with _cgreq_ extension.
See protoc-gen-cgreq README.md for more info. To generate _cgreq_ files out of any number of proto files stored in **testdata** directory, use **atlas-regen-tdata** Make targer from the project root directory. It uses _buf.yaml_ and _buf.gen.yaml_ [buf](https://github.com/bufbuild/buf-tour) configuration files to actually do the compilation. [bufbuild/buf](https://github.com/bufbuild/buf) is another alternative to do such compilation besides protoc. See its documentation [here](https://docs.buf.build/introduction).

Invoke **atlas-regen-tdata** Make targer after any change to proto files in **testdata** directory to ensure proper test results.

As of writing these notes, **testdata** were only used by **Test_generator_Generate** test in _generator_test.go_ file. The test first regenerates _*.emitted.swagger.json_ file and compares it against wanted sibling - _*.wanted.swagger.json_. Multiple tests are discerned by their names. For example, atlaspatch is the name the test uses to select proper file for comparison:

```
├── atlaspatch.cgreq
├── atlaspatch.emitted.swagger.json
├── atlaspatch.proto
├── atlaspatch.wanted.swagger.json
```

When a test proto file should import another proto file, use **imports** directory to store it. See existing _atlaspatch.proto_ for guidance and how to adjust import path properly. 
